{"pageProps":{"mdMeta":{"realpath":"/home/runner/work/jokester.github.io/jokester.github.io/posts/2017/2017-04-01-nginx-http2-benchmark.md","slug":["2017-04-01","nginx-http2-benchmark"],"frontMatter":{"title":"A simple benchmark of nginx http2","publishAt":"2017-04-01"}},"mdContent":"\nJust updated my nginx sites to use http2. `nginx 1.10` package in Alpine linux already have this feature built. All I did is to enable it: changing `listen 443 ssl;` to `listen 443 ssl http2;`.\n\nThe following benchmark is done with [ab](https://httpd.apache.org/docs/2.4/programs/ab.html) / [nghttp2](https://nghttp2.org/documentation/index.html) and a static site hosted by `nginx 1.10.3` / `alpine 3.5` / 1cpu / 512M mem.\n\n# 50 connection:\n\n```text\n% h2load -n 500 -c 50 https://some-site.jokester.io/\n\nfinished in 2.37s, 210.62 req/s, 7.47MB/s\nrequests: 500 total, 500 started, 500 done, 500 succeeded, 0 failed, 0 errored, 0 timeout\nstatus codes: 500 2xx, 0 3xx, 0 4xx, 0 5xx\ntraffic: 17.74MB (18606450) total, 103.52KB (106000) headers (space savings 31.39%), 17.62MB (18471000) data\n                     min         max         mean         sd        +/- sd\ntime for request:   307.92ms    937.78ms    658.94ms    157.61ms    61.00%\ntime for connect:   478.13ms       1.45s    905.85ms    279.07ms    57.00%\ntime to 1st byte:   641.92ms       1.63s       1.15s    234.91ms    68.00%\nreq/s           :       4.21        8.23        5.95        1.05    60.00%\n```\n\n```text\n% ab -n 500 -c 50 https://some-site.jokester.io/\n\nConcurrency Level:      50\nTime taken for tests:   10.139 seconds\nComplete requests:      500\nFailed requests:        0\nWrite errors:           0\nTotal transferred:      18661500 bytes\nHTML transferred:       18471000 bytes\nRequests per second:    49.32 [#/sec] (mean)\nTime per request:       1013.864 [ms] (mean)\nTime per request:       20.277 [ms] (mean, across all concurrent requests)\nTransfer rate:          1797.49 [Kbytes/sec] received\n\nConnection Times (ms)\n              min  mean[+/-sd] median   max\nConnect:      456  572 116.5    549    1209\nProcessing:   290  334  19.0    331     394\nWaiting:      145  175  12.4    174     215\nTotal:        762  906 122.5    880    1579\n\nPercentage of the requests served within a certain time (ms)\n  50%    880\n  66%    906\n  75%    921\n  80%    933\n  90%    970\n  95%   1183\n  98%   1382\n  99%   1477\n 100%   1579 (longest request)\n```\n\n# 100 connection\n\n- all requests served happily\n- http2 reduces average but has larger _max time_\n\n```text\n% h2load -n 1000 -c 100 https://some-site.jokester.io/\n\nfinished in 3.41s, 293.48 req/s, 10.42MB/s\nrequests: 1000 total, 1000 started, 1000 done, 1000 succeeded, 0 failed, 0 errored, 0 timeout\nstatus codes: 1000 2xx, 0 3xx, 0 4xx, 0 5xx\ntraffic: 35.49MB (37212900) total, 207.03KB (212000) headers (space savings 31.39%), 35.23MB (36942000) data\n                     min         max         mean         sd        +/- sd\ntime for request:   313.89ms    964.01ms    652.30ms    152.53ms    64.50%\ntime for connect:   495.74ms       2.49s       1.44s    604.65ms    54.00%\ntime to 1st byte:   668.02ms       2.68s       1.65s    571.72ms    52.00%\nreq/s           :       2.94        7.99        4.81        1.44    61.00%\n```\n\n```text\n% ab -n 1000 -c 100 https://some-site.jokester.io/\n\nConcurrency Level:      100\nTime taken for tests:   17.420 seconds\nComplete requests:      1000\nFailed requests:        0\nWrite errors:           0\nTotal transferred:      37323000 bytes\nHTML transferred:       36942000 bytes\nRequests per second:    57.40 [#/sec] (mean)\nTime per request:       1742.013 [ms] (mean)\nTime per request:       17.420 [ms] (mean, across all concurrent requests)\nTransfer rate:          2092.31 [Kbytes/sec] received\n\nConnection Times (ms)\n              min  mean[+/-sd] median   max\nConnect:      483 1255 147.0   1257    2007\nProcessing:   304  342  17.8    341     402\nWaiting:      157  183   9.8    183     220\nTotal:        793 1598 155.2   1599    2388\n\nPercentage of the requests served within a certain time (ms)\n  50%   1599\n  66%   1622\n  75%   1637\n  80%   1648\n  90%   1679\n  95%   1734\n  98%   2068\n  99%   2227\n 100%   2388 (longest request)\n```\n\n# 1000 connection\n\n- 1.6% of http2 requests failed (h2load not showing the reason)\n- 9% of http1 requests failed (during SSL handshake)\n\n```text\n% h2load -n 10000 -c 1000 https://some-site.jokester.io/\n\nfinished in 56.44s, 174.35 req/s, 6.19MB/s\nrequests: 10000 total, 9840 started, 10000 done, 9840 succeeded, 160 failed, 160 errored, 0 timeout\nstatus codes: 9840 2xx, 0 3xx, 0 4xx, 0 5xx\ntraffic: 349.21MB (366174936) total, 1.99MB (2086080) headers (space savings 31.39%), 346.67MB (363509280) data\n                     min         max         mean         sd        +/- sd\ntime for request:   292.37ms       1.64s    671.62ms    185.01ms    76.52%\ntime for connect:   508.90ms      55.53s      14.23s      10.82s    66.67%\ntime to 1st byte:   677.41ms      55.71s      14.45s      10.82s    66.67%\nreq/s           :       0.00        7.94        1.23        1.31    88.70%\n```\n\n```text\n% ab -n 10000 -c 1000 https://some-site.jokester.io/\n\nConcurrency Level:      1000\nTime taken for tests:   147.935 seconds\nComplete requests:      10000\nFailed requests:        939\n   (Connect: 0, Receive: 0, Length: 939, Exceptions: 0)\nWrite errors:           0\nTotal transferred:      338405805 bytes\nHTML transferred:       334949373 bytes\nRequests per second:    67.60 [#/sec] (mean)\nTime per request:       14793.489 [ms] (mean)\nTime per request:       14.793 [ms] (mean, across all concurrent requests)\nTransfer rate:          2233.92 [Kbytes/sec] received\n\nConnection Times (ms)\n              min  mean[+/-sd] median   max\nConnect:        0 4101 4893.8   2652   69653\nProcessing:   298 8098 27087.2    345  110250\nWaiting:        0  169  51.8    182     272\nTotal:        787 12199 26345.0   3252  110250\n\nPercentage of the requests served within a certain time (ms)\n  50%   3252\n  66%   4386\n  75%   6242\n  80%   7069\n  90%  18392\n  95%  110146\n  98%  110186\n  99%  110201\n 100%  110250 (longest request)\n```\n"},"__N_SSG":true}