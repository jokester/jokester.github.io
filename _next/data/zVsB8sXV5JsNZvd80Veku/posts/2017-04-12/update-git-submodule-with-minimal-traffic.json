{"pageProps":{"mdMeta":{"realpath":"/home/runner/work/jokester.github.io/jokester.github.io/posts/2017/2017-04-12-update-git-submodule-with-minimal-traffic.md","slug":["2017-04-12","update-git-submodule-with-minimal-traffic"],"frontMatter":{"title":"Update git submodule with minimal traffic","publishAt":"2017-04-12"}},"mdContent":"\n`git update --init` by default performs a normal `git clone`. This is less favorable when bandwidth or traffic is limited. I'm going to show a workaround for this, the core idea is to only fetch the needed commit.\n\nThe following steps used a small repository that contains submodule: [node-libtidy](https://github.com/gagern/node-libtidy).\n\n#### 1. shallow clone the submodule repo\n\n    $ git submodule update --init --depth=1\n\nIt is normal to see a error here, don't panic.\n\n```text\nremote: Total 0 (delta 0), reused 0 (delta 0), pack-reused 0\nerror: no such remote ref abb03163aeafb8b7fc1efd2413d9f077bcdbeed9\nFetched in submodule path 'tidy-html5', but it did not contain abb03163aeafb8b7fc1efd2413d9f077bcdbeed9.\nDirect fetching of that commit failed.\n```\n\n#### 2. find the needed commit SHA1\n\nIf the previous command contains the SHA1, just use it.\n\nThere are other ways if you missed it:\n\n```text\n$ git submodule status\n-abb03163aeafb8b7fc1efd2413d9f077bcdbeed9 tidy-html5\n\n# OR\n\n$ git ls-tree HEAD:\n100644 blob d32ca78ff42b7cf2b532a1eb1dd35bc81b584046    .gitignore\n...\n160000 commit abb03163aeafb8b7fc1efd2413d9f077bcdbeed9  tidy-html5\n```\n\n(background: commit sha1 of submodule is stored in a git `tree` object)\n\n#### 3. fetch that commit\n\n```text\n# cd into the bare repo cloned for the submodule\n$ cd .git/modules/tidy-html5/\n\n# fetch by sha1, the full sha1 is required\n$ git fetch origin abb03163aeafb8b7fc1efd2413d9f077bcdbeed9\n```\n\n#### 4. checkout the correct commit in submodule\n\n```text\n# back to main repo\n$ cd ../../../\n\n# update the submodule again without fetch, it should succeed this time\n$ git submodule update --no-fetch\n```\n"},"__N_SSG":true}