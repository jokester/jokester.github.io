<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-39627402-1"></script><script>
            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());
            gtag('config', 'UA-39627402-1', {
              page_path: window.location.pathname,
            });
          </script><title>Checklist before Switching to HTTPS</title><meta http-equiv="X-UA-Compatible" content="IE=edge"/><meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1.5,minimum-scale=1"/><link rel="canonical" href="https://jokester.github.io/posts/2017-07-03/checklist-switching-to-https"/><meta name="next-head-count" content="7"/><link rel="preload" href="/_next/static/css/63fa5f5ae0ef060f.css" as="style"/><link rel="stylesheet" href="/_next/static/css/63fa5f5ae0ef060f.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-3278669249d12298.js" defer=""></script><script src="/_next/static/chunks/framework-e6d86b677864e3f5.js" defer=""></script><script src="/_next/static/chunks/main-899d8f68bcf1b91c.js" defer=""></script><script src="/_next/static/chunks/pages/_app-ae73a96cb32306a3.js" defer=""></script><script src="/_next/static/chunks/782-c0d129453d73cf2f.js" defer=""></script><script src="/_next/static/chunks/503-60468e2aaeee9d33.js" defer=""></script><script src="/_next/static/chunks/pages/posts/%5B...slug%5D-3dca7f9898ec5bee.js" defer=""></script><script src="/_next/static/_eqUY05tLYeOqeMVrs-Bb/_buildManifest.js" defer=""></script><script src="/_next/static/_eqUY05tLYeOqeMVrs-Bb/_ssgManifest.js" defer=""></script></head><body class="overflow-y-scroll"><div id="__next"><div class="bg-black text-yellow-100"><div class="px-2 sm:px-4 py-1 flex items-center bg-gray-900 space-x-3 text-sm"><a class="hidden text-lg" href="/">挖</a><a class="inline-block sm:hidden text sm:text-lg" href="/">挖坑自動機</a><a class="hidden sm:inline-block text-lg" href="/">挖坑自動機 / Digging automaton</a><span>|</span><a class="text-yellow-200" href="/posts">/posts</a><a class="" href="/demos">/demos</a><a class="" href="/works">/works</a><a class="" href="/about">/about</a></div><div class="min-h-screen container mx-auto"><div class="px-4 pt-6"><div class="markdown"><h1></h1><hr/><div class="markdown"><p>This is a memo before I switched all my services to https.</p>
<ul>
<li>toc
{:toc}</li>
</ul>
<h2>User Experience</h2>
<h3>Browser support: can users still view my site?</h3>
<ul>
<li><em>most</em> browser support TLS 1.0 and up.</li>
<li>The only reason to enable SSL would be IE6 users <code>/bless</code>.</li>
</ul>
<h3>Content: (if https is supported at all) will users still see complete content?</h3>
<p>This relates to how browser handles <a href="https://developer.mozilla.org/en-US/docs/Web/Security/Mixed_content">mixed content</a>,
the non-https resources in a https page.</p>
<ul>
<li><code>active mixed content</code> (e.g. <code>&lt;script src=</code>) are blocked by most browsers<!-- -->
<ul>
<li>FX 23 +</li>
<li>IE 9 +</li>
<li>Chrome</li>
</ul>
</li>
<li><code>passive mixed content</code> (e.g. <code>&lt;img src=</code>)<!-- -->
<ul>
<li><code>&lt;img&gt;</code> loads with warning</li>
</ul>
</li>
</ul>
<h2>Cost and Performance</h2>
<p>Will server experience high load and explode?</p>
<h3>Breakdown of SSL overhead</h3>
<p>The extra stuff browser and server have to do includes:</p>
<ul>
<li>Session Establishment<!-- -->
<ul>
<li>the part where client and server determines a encryption key for data transfer</li>
<li>once per SSL session<!-- -->
<ul>
<li>Some webservers support reuse of ssl session. nginx does.</li>
</ul>
</li>
<li>cipher negotiation (<a href="https://en.wikipedia.org/wiki/Cipher_suite">cipher suite</a>)</li>
<li>asymmetric encryption, typically RSA<!-- -->
<ul>
<li>simple benchmark: <code>openssl speed rsa</code></li>
</ul>
</li>
</ul>
</li>
<li>After established: client and server exchange encrypted data<!-- -->
<ul>
<li>the part where client and server flows encrypted data to each other</li>
<li>symmetric encryption, typically AES<!-- -->
<ul>
<li>nowdays CPUs have intrustion set to accelerate this</li>
<li>simple benchmark: <code>openssl speed aes</code></li>
</ul>
</li>
</ul>
</li>
</ul>
<p>A good illustration of SSL: <a href="https://www.ssl.com/article/ssl-tls-handshake-overview/">ssl-tls-handshake-overview</a></p>
<h3>Estimation of overhead</h3>
<p>We can use <code>openssl speed rsa aes</code> to estimate intensity and throughput of a server.
In my $5 vultr instance (1cpu / 1G mem / AES-NI supported), I am getting this result:</p>
<pre><code class="language-text">type             16 bytes     64 bytes    256 bytes   1024 bytes   8192 bytes
aes-128 cbc      92395.92k   101214.20k   102269.63k   227764.25k   226313.75k
aes-192 cbc      76020.25k    83423.61k    85446.95k   191443.81k   192688.75k
aes-256 cbc      67800.93k    71916.01k    72710.14k   159391.21k   165057.65k

                  sign    verify    sign/s verify/s
rsa  512 bits 0.000070s 0.000005s  14302.2 203856.8
rsa 1024 bits 0.000193s 0.000013s   5183.6  79046.3
rsa 2048 bits 0.000908s 0.000040s   1101.7  25136.7
rsa 4096 bits 0.009625s 0.000149s    103.9   6691.5
</code></pre>
<p>That means for my small-to-medium traffic sites, SSL overhead is not likely to exceed around 10% of CPU.</p>
<h2>Tools</h2>
<ul>
<li><a href="https://www.ssllabs.com/ssltest/index.html">SSL Server Test</a> tells you what can be hardened further.</li>
</ul>
<h2>References</h2>
<ul>
<li>Usage statistics of SSL: <a href="https://www.ssllabs.com/ssl-pulse/">SSL Pulse</a></li>
<li><a href="https://www.owasp.org/index.php/SSL_TLS_Knowledge_Center">SSL TLS Knowledge Center</a></li>
</ul></div></div></div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"mdMeta":{"realpath":"/home/runner/work/jokester.github.io/jokester.github.io/posts/2017/2017-07-03-checklist-switching-to-https.md","slug":["2017-07-03","checklist-switching-to-https"],"frontMatter":{"title":"Checklist before Switching to HTTPS","publishAt":"2017-07-03"}},"mdContent":"\nThis is a memo before I switched all my services to https.\n\n- toc\n  {:toc}\n\n## User Experience\n\n### Browser support: can users still view my site?\n\n- _most_ browser support TLS 1.0 and up.\n- The only reason to enable SSL would be IE6 users `/bless`.\n\n### Content: (if https is supported at all) will users still see complete content?\n\nThis relates to how browser handles [mixed content](https://developer.mozilla.org/en-US/docs/Web/Security/Mixed_content),\nthe non-https resources in a https page.\n\n- `active mixed content` (e.g. `\u003cscript src=`) are blocked by most browsers\n  - FX 23 +\n  - IE 9 +\n  - Chrome\n- `passive mixed content` (e.g. `\u003cimg src=`)\n  - `\u003cimg\u003e` loads with warning\n\n## Cost and Performance\n\nWill server experience high load and explode?\n\n### Breakdown of SSL overhead\n\nThe extra stuff browser and server have to do includes:\n\n- Session Establishment\n  - the part where client and server determines a encryption key for data transfer\n  - once per SSL session\n    - Some webservers support reuse of ssl session. nginx does.\n  - cipher negotiation ([cipher suite](https://en.wikipedia.org/wiki/Cipher_suite))\n  - asymmetric encryption, typically RSA\n    - simple benchmark: `openssl speed rsa`\n- After established: client and server exchange encrypted data\n  - the part where client and server flows encrypted data to each other\n  - symmetric encryption, typically AES\n    - nowdays CPUs have intrustion set to accelerate this\n    - simple benchmark: `openssl speed aes`\n\nA good illustration of SSL: [ssl-tls-handshake-overview](https://www.ssl.com/article/ssl-tls-handshake-overview/)\n\n### Estimation of overhead\n\nWe can use `openssl speed rsa aes` to estimate intensity and throughput of a server.\nIn my \\$5 vultr instance (1cpu / 1G mem / AES-NI supported), I am getting this result:\n\n```text\ntype             16 bytes     64 bytes    256 bytes   1024 bytes   8192 bytes\naes-128 cbc      92395.92k   101214.20k   102269.63k   227764.25k   226313.75k\naes-192 cbc      76020.25k    83423.61k    85446.95k   191443.81k   192688.75k\naes-256 cbc      67800.93k    71916.01k    72710.14k   159391.21k   165057.65k\n\n                  sign    verify    sign/s verify/s\nrsa  512 bits 0.000070s 0.000005s  14302.2 203856.8\nrsa 1024 bits 0.000193s 0.000013s   5183.6  79046.3\nrsa 2048 bits 0.000908s 0.000040s   1101.7  25136.7\nrsa 4096 bits 0.009625s 0.000149s    103.9   6691.5\n```\n\nThat means for my small-to-medium traffic sites, SSL overhead is not likely to exceed around 10% of CPU.\n\n## Tools\n\n- [SSL Server Test](https://www.ssllabs.com/ssltest/index.html) tells you what can be hardened further.\n\n## References\n\n- Usage statistics of SSL: [SSL Pulse](https://www.ssllabs.com/ssl-pulse/)\n- [SSL TLS Knowledge Center](https://www.owasp.org/index.php/SSL_TLS_Knowledge_Center)\n"},"__N_SSG":true},"page":"/posts/[...slug]","query":{"slug":["2017-07-03","checklist-switching-to-https"]},"buildId":"_eqUY05tLYeOqeMVrs-Bb","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>